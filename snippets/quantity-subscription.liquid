<style>
  .make-subscription {
    display: block;
    margin-bottom: 10px;
  }
  .hidden-element {
    display: none !important;
  }
  .product-form__input {
    max-width: unset;
  }
  .product-form__input > #tabheadings > label, .product-form__input > #tabheadings-nosub > label {
    background-color: rgba(0,0,0,0);
    border-radius: unset;
    padding: 1rem;
    border: none !important;
  }
  #once-container, #subs-container {
    border: 1px solid #E6EAE8;
    background-color: #F8F8F8;
  }
  #once-container.selected, #subs-container.selected {
    border-bottom: none;
    background-color: #FFFFFF;
  }
  #once, #subs {
    appearance: auto;
    -webkit-appearance: auto;
    -moz-appearance: auto;
    position: static !important;
    height: unset !important;
    width: unset !important;
  }
  input[name="subscription"] {
    appearance: auto;
    -webkit-appearance: auto;
    -moz-appearance: auto;
    position: static !important;
    height: unset !important;
    width: unset !important;
  }
  input[name="onetime"], input[name="onetime-nosub"] {
    appearance: auto;
    -webkit-appearance: auto;
    -moz-appearance: auto;
    position: static !important;
    height: unset !important;
    width: unset !important;
  }
  #oncelabel, #oncelabel-nosub {
    color: rgba(17,17,17,0.5);
    margin-bottom: 0;
  }
  #subslabel {
    color: rgba(0,0,0,1);
    margin-bottom: 0;
  }
  .product-form__input > #tabheadings > input:checked + label, .product-form__input > #tabheadings-nosub > input:checked + label {
    opacity: 1;
    background-color: #fbf9f7;
  }
  label svg {
    height: 17px;
  }
  #quantity-subscription-body, #quantity-subscription-body-nosub {
    background-color: #fbf9f7;
    width: 100%;
  }
  quantity-input {
    background-color: #ffffff;
    border: 1px solid #cccccc !important;
  }
  .hidden-vis {
    visibility: hidden;
  }
  .product-form__input input[type='radio'] + label {
    border: none;
    border-radius: 0;
  }
  .product-form__input input[type='radio'] + label:hover {
    border: none;
    outline: none;
  }
  .product-form__input input[type='radio']:checked + label {
    color: var(--color-foreground);
    background-color: var(--color-background);
  }
  #subscription-btn-wrapper button {
    color: #000000;
    background-color: #ffcc00;
    border: none;
    box-shadow: none;
  }
  #subscription-btn-wrapper button:hover {
    background: #ffd940;
  }
  #quantity-wrapper input {
    background-color: #ffffff !important;
    color: #111111 !important;
  }
  #quantity-wrapper label, #quantity-wrapper-nosub label {
    color: #111111 !important;
    text-decoration: none !important;
  }
  .green {
    color: #00706e;
  }
  .red {
    color: #ff0000;
  }
  .active-variant {
    background-color: hsl(30,18.2%,90%);
  }
</style>
{% if curr_variant.metafields.global.subscriptions.value.size > 0 %}
  <div class="product-form__input product-form__subscription w-100p" {{ block.shopify_attributes }}>
    <div class="flex row jc-fs ai-c" id="tabheadings">
      <div class="flex row jc-c selected" style="width: 42%;" id="once-container">
        <input type="radio" value="once" name="mode" id="once" checked>
        <label for="once" class="checked" id="oncelabel">
          <span class="ff-heading fs-12px lh-19px" style="position: relative; bottom: 2px;">
            Einzelkauf
          </span>
        </label>
      </div>
      <div class="flex row jc-c" style="width: 58%;" id="subs-container">
        <input type="radio" value="subs" name="mode" id="subs">
        <label for="subs" id="subslabel" class="flex row ai-c">
          <span style="position: relative; bottom: 2px;" class="ff-heading fs-12px lh-19px">
            Sparabo
          </span> 
          <span style="position: relative; bottom: 2px; color: white; background-color: #317752; padding: 3px 6px; border-radius: 5px;" class="ff-body fs-11px lh-13px ls-m050">
            {% liquid 
              for sub in curr_variant.metafields.global.subscriptions.value
                assign curr = sub.cost
                assign content = sub.content
                assign reference = curr_variant.metafields.global.prices.value | where: 'content', content | first
                assign ref = reference.cost | times: reference.number
                assign diff = curr | minus: ref | abs
                assign saving = 100 | times: diff | divided_by: ref | round
                if forloop.index0 == 0
                  assign max_saving = saving
                elsif saving > max_saving
                  assign max_saving = saving
                endif
              endfor
            %}
            {% if max_saving > 0 %}bis {{ max_saving }}% Rabatt{% endif %}
          </span>
        </label>
      </div>
    </div>
    <div id="quantity-subscription-body">
      <div id="quantity-wrapper" class="flex column">
        <div class="flex column ai-fs jc-fs">
          <p class="my-0 fs-2 lh-116">
            <span id="totalcompare" class="fw-400 td-lt" style="color: rgba(17,17,17,0.8);"></span>
            <span id="total" class="ff-body fw-700 fs-24px lh-27px">{{ curr_variant.price | money_without_currency }} €</span>
          </p>
          <p class="my-0 fs-12px lh-100 fw-300">
            <span id="unitprice">
              {% liquid
                assign reference = curr_variant.metafields.global.prices.value[0].reference
                assign unit = curr_variant.metafields.global.prices.value[0].unit
                assign content = curr_variant.metafields.global.prices.value[0].content 
                assign cost = curr_variant.metafields.global.prices.value[0].cost 
              %}
              {% if reference and unit and content and cost %}
                {{ reference | times: cost | divided_by: content | money_without_currency }} €/{{ reference }} {{ unit }}
              {% endif %}
            </span>
            <span class="fs-12px fw-300">inkl. MwSt.</span>
          </p>
        </div>
        <select>
          {%- for price in curr_variant.metafields.global.prices.value -%}
            <option value="{{ forloop.index }}">
              <span class="fw-600">Menge:</span>
              <span>{{ forloop.index }}x {{ curr_variant.metafields.global.prices.value[0].subtitle }}</span>
            </option>
          {%- endfor -%}
        </select>
        {%- for price in curr_variant.metafields.global.prices.value -%}
          {% liquid 
            assign currs = price.cost
            assign references = curr_variant.metafields.global.prices.value[0]
            assign refs = references.cost
            assign diffs = currs | minus: refs | abs
            assign savings = 100 | times: diffs | divided_by: refs | round
          %}
          <div class="flex row ai-c px-4 py-5{% if forloop.index0 == 0 %} active-variant{% endif %}" style="{% if forloop.index0 != 0 %}border-top: 2px solid white;{% endif %}" id="once-{{ forloop.index0 }}-wrapper">
            <input type="radio" name="onetime" id="once-{{ forloop.index0 }}" {% if forloop.index0 == 0 %}checked{% endif %} class="mr-5">
            <label class="w-100p flexi row jc-fs ai-c mx-0i my-0i px-0i py-0i" for="once-{{ forloop.index0 }}">
              <img src="{{ product.featured_image | image_url: width: 50 }}" 
                srcset="{{ product.featured_image | image_url: width: 50 }} 1x, {{ product.featured_image | image_url: width: 100 }} 2x"
                alt="{{ product.featured_image.alt | escape }}" width="50" height="50" loading="lazy" class="mr-4">
              <div class="flex row jc-spb ai-c w-100p">
                <span class="flex column jc-fs ai-fs fs-0">
                  <span class="fw-500">
                    {{ price.title }}
                  </span>
                  <span class="fw-300">
                    {{ price.subtitle }}
                  </span>
                </span>
                <span class="flex column jc-fe ai-fe">
                  {% if savings > 0 %}
                    <span style="background-color: #ffcc00; padding: 6px 13px; color: black; font-weight: 500; border-radius: 40px;" class="mb-3">{{ savings }}% gespart</span>
                  {% endif %}
                  <span class="fs-2 fw-700 ta-r">{% if price.perUnit %}<span class="fw-300 fs-0">je </span>{% endif %}{{ price.cost | money_without_currency }} €</span>
                </span>
              </div>
            </label>
          </div>
        {%- endfor -%}
      </div>
      <div class="subscription hidden-element flex column" id="subscription">
        {%- for sub in curr_variant.metafields.global.subscriptions.value -%}
          {% liquid 
            assign curr = sub.cost
            assign content = sub.content
            assign reference = curr_variant.metafields.global.prices.value | where: 'content', content | first
            assign ref = reference.cost | times: reference.number
            assign diff = curr | minus: ref | abs
            assign saving = 100 | times: diff | divided_by: ref | round
          %}
          <div class="flex row jc-fs ai-c w-100p px-4 py-5{% if forloop.index0 == 0 %} active-variant{% endif %}" style="{% if forloop.index0 != 0 %}border-top: 2px solid white;{% endif %}" id="sub-{{ forloop.index0 }}-wrapper">
            <input type="radio" value="{{ forloop.index0 }}" name="subscription" id="sub-{{ forloop.index0 }}"{% if forloop.index0 == 0 %} checked{% endif %} class="mr-5">
            <label for="sub-{{ forloop.index0 }}" class="flexi row jc-spb ai-c w-100p my-0i mx-0i px-0i py-0i">
              <p class="flex column jc-c ai-fs fs-0">
                <span class="fw-500">
                  {{ sub.title }}
                </span>
                <span class="fw-300">
                  {{ sub.subtitle }}
                </span>
              </p>
              <span class="flex column jc-fe ai-fe">
                {% if saving %}
                  <span style="background-color: #ffcc00; padding: 6px 13px; color: black; font-weight: 500; border-radius: 40px;" class="mb-3">{{ saving }}% gespart</span>
                {% endif %}
                <span class="fs-2 fw-700 ta-r">{{ sub.cost | money_without_currency }} €</span>
              </span>
            </label>
          </div>
        {%- endfor -%}
      </div>
      <div class="flex row jc-c ai-c w-100p px-4 py-5" style="border-top: 2px solid white;">
        <img src="https://cdn.shopify.com/s/files/1/0579/2697/5668/files/kunden-kauften.png?v=1639562854" alt="kunden-kauften" width="46" height="20" loading="lazy">
        <p class="ff-body fs-0 lh-100 fw-300 ml-3">
          Mehr als <span class="fw-500">{{ curr_product.metafields.global.numberBuyers.value }}x</span> in den letzten <span class="fw-500">4 Stunden</span> gekauft
        </p>
      </div>
    </div>
    <div class="w-100p py-7 flex row ai-c" style="background-color: #ffffff;" id="quantity-input-wrapper">
      <quantity-input class="quantity mr-4" id="quantity-input">
        <button class="quantity__button no-js-hidden" name="minus" type="button">
          <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
          {% render 'icon-minus' %}
        </button>
        <input class="quantity__input"
          type="number"
          name="quantity"
          id="Quantity-{{ section.id }}"
          min="1"
          value="1"
          form="product-form-{{ section.id }}"
        >
        <button class="quantity__button no-js-hidden" name="plus" type="button">
          <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
          {% render 'icon-plus' %}
        </button>
      </quantity-input>
    </div>
    <div class="flex column ai-fs jc-fs py-7 hidden-element" id="subscription-price-wrapper">
      <p class="my-0 fs-2 lh-100">
        <span id="substotal" class="fw-700 ls-m080">{{ curr_variant.metafields.global.subscriptions.value[0].cost | money_without_currency }} €</span>
        <span id="substotalcompare" class="fw-400 td-lt">{{ curr_variant.price | money_without_currency }} €</span>
        <span class="fs-12px fw-300">inkl. MwSt.</span>
      </p>
      <p class="my-0 fs-12px lh-100 fw-300">
        <span id="subsunitprice">
          {% liquid
            assign reference = curr_variant.metafields.global.subscriptions.value[0].reference
            assign unit = curr_variant.metafields.global.subscriptions.value[0].unit
            assign content = curr_variant.metafields.global.subscriptions.value[0].content 
            assign cost = curr_variant.metafields.global.subscriptions.value[0].cost 
          %}
          {{ reference | times: cost | divided_by: content | money_without_currency }} €/{{ reference }} {{ unit }}
        </span>
      </p>
    </div>
  </div>
{% else %}
<div class="product-form__input product-form__subscription w-100p" {{ block.shopify_attributes }}>
  <div class="flex row jc-fs ai-c" id="tabheadings-nosub">
    <input type="radio" value="once" name="mode" id="once-nosub" checked>
    <label for="once-nosub" class="checked" id="oncelabel-nosub">Einzelkauf</label>
  </div>
  <div id="quantity-subscription-body-nosub">
    <div id="quantity-wrapper-nosub" class="flex column">
      {%- for price in curr_variant.metafields.global.prices.value -%}
        {% liquid 
          assign currs = price.cost
          assign references = curr_variant.metafields.global.prices.value[0]
          assign refs = references.cost
          assign diffs = currs | minus: refs | abs
          assign savings = 100 | times: diffs | divided_by: refs | round
        %}
        <div class="flex row ai-c px-4 py-5{% if forloop.index0 == 0 %} active-variant{% endif %}" style="{% if forloop.index0 != 0 %}border-top: 2px solid white;{% endif %}" id="once-{{ forloop.index0 }}-wrapper-nosub">
          <input type="radio" name="onetime-nosub" id="once-{{ forloop.index0 }}-nosub" {% if forloop.index0 == 0 %}checked{% endif %} class="mr-5">
          <label class="w-100p flexi row jc-fs ai-c mx-0i my-0i px-0i py-0i" for="once-{{ forloop.index0 }}-nosub">
            <img src="{{ product.featured_image | image_url: width: 50 }}" 
              srcset="{{ product.featured_image | image_url: width: 50 }} 1x, {{ product.featured_image | image_url: width: 100 }} 2x"
              alt="{{ product.featured_image.alt | escape }}" width="50" height="50" loading="lazy" class="mr-4">
            <div class="flex row jc-spb ai-c w-100p">
              <span class="flex column jc-fs ai-fs fs-0">
                <span class="fw-500">
                  {{ price.title }}
                </span>
                <span class="fw-300">
                  {{ price.subtitle }}
                </span>
              </span>
              <span class="flex column jc-fe ai-fe">
                {% if savings > 0 %}
                  <span style="background-color: #ffcc00; padding: 6px 13px; color: black; font-weight: 500; border-radius: 40px;" class="mb-3">{{ savings }}% gespart</span>
                {% endif %}
                <span class="fs-2 fw-700 ta-r">{% if price.perUnit %}<span class="fw-300 fs-0">je </span>{% endif %}{{ price.cost | money_without_currency }} €</span>
              </span>
            </div>
          </label>
        </div>
      {%- endfor -%}
    </div>
    {% if curr_product.metafields.global.numberBuyers.value %}
    <div class="flex row jc-c ai-c w-100p px-4 py-5" style="border-top: 2px solid white;">
      <img src="https://cdn.shopify.com/s/files/1/0579/2697/5668/files/kunden-kauften.png?v=1639562854" alt="kunden-kauften" width="46" height="20" loading="lazy">
      <p class="ff-body fs-0 lh-100 fw-300 ml-3">
        Mehr als <span class="fw-500">{{ curr_product.metafields.global.numberBuyers.value }}x</span> in den letzten <span class="fw-500">4 Stunden</span> gekauft
      </p>
    </div>
    {% endif %}
  </div>
  <div class="w-100p py-7 flex row ai-c" style="background-color: #ffffff;" id="quantity-input-wrapper">
    <quantity-input class="quantity mr-4" id="quantity-input-nosub">
      <button class="quantity__button no-js-hidden" name="minus" type="button">
        <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
        {% render 'icon-minus' %}
      </button>
      <input class="quantity__input"
        type="number"
        name="quantity"
        id="Quantity-{{ section.id }}"
        min="1"
        value="1"
        form="product-form-{{ section.id }}"
      >
      <button class="quantity__button no-js-hidden" name="plus" type="button">
        <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
        {% render 'icon-plus' %}
      </button>
    </quantity-input>
    <div class="flex column ai-fs jc-fs">
      <p class="my-0 fs-2 lh-100">
        <span id="total-nosub" class="fw-700 ls-m080">{{ curr_variant.price | money_without_currency }} €</span>
        <span id="totalcompare-nosub" class="fw-400 td-lt"></span>
        <span class="fs-12px fw-300">inkl. MwSt.</span>
      </p>
      <p class="my-0 fs-12px lh-100 fw-300">
        <span id="unitprice-nosub">
          {% liquid
            assign reference = curr_variant.metafields.global.prices.value[0].reference
            assign unit = curr_variant.metafields.global.prices.value[0].unit
            assign content = curr_variant.metafields.global.prices.value[0].content 
            assign cost = curr_variant.metafields.global.prices.value[0].cost 
          %}
          {{ reference | times: cost | divided_by: content | money_without_currency }} €/{{ reference }} {{ unit }}
        </span>
      </p>
    </div>
  </div>
</div>
  {% endif %}
</div>
{% if curr_variant.available %}
  <div {{ block.shopify_attributes }} id="subscription-btn-wrapper" class="hidden-element">
    <div>
      <a href="https://abo.schlafdrink.de/cart/{{ curr_variant.metafields.global.subscriptions.value[0].vid | escape }}:1"  class="make-subscription nodec" id="subscription-link">
        <button
          type="button"
          class="button button--full-width py-5 px-7 fw-700 ls-p080 fs-0 ff-body uppercase"
        >
          Abonnement abschließen
        </button>
      </a>
    </div>
  </div>
{% endif %}
{% if curr_variant.available %}
<div class="mt-4 flex row jc-c ai-c checkmark ff-body fs-0 lh-100 hidden-element green" id="subscription-checkmark-wrapper" style="color: #00706e !inportant;">
  {% render 'icon-checkmark' %}
  <span>
    <b>
      Auf Lager –
    </b>
    in 1-3 Tagen bei Dir
  </span>
</div>
{% else %}
<div class="mt-4 flex row jc-c ai-c checkmark ff-body fs-0 lh-100 hidden-element red" id="subscription-checkmark-wrapper">
  {% render 'icon-unavailable' %}
  <span>
    <b>
      Ausverkauft
    </b>
  </span>
</div>
{% endif %}
<script>
  function changeButtons() {
    if(document.getElementById("once").checked) {
      document.getElementById("once-container").classList.add("selected")
      document.getElementById("subs-container").classList.remove("selected")
      document.getElementById("subscription-btn-wrapper").classList.add("hidden-element")
      document.getElementById("buy-buttons").classList.remove("hidden-element")
      document.getElementById("quantity-wrapper").classList.remove("hidden-element")
      document.getElementById("quantity-input-wrapper").classList.remove("hidden-element")
      document.getElementById("subscription").classList.add("hidden-element")
      document.getElementById("oncelabel").classList.add("checked")
      document.getElementById("subslabel").classList.remove("checked")
      document.getElementById("subscription-price-wrapper").classList.add("hidden-element")
      document.getElementById("subscription-checkmark-wrapper").classList.add("hidden-element")
    }
    if(document.getElementById("subs").checked) {
      document.getElementById("once-container").classList.remove("selected")
      document.getElementById("subs-container").classList.add("selected")
      document.getElementById("subscription-btn-wrapper").classList.remove("hidden-element")
      document.getElementById("buy-buttons").classList.add("hidden-element")
      document.getElementById("quantity-wrapper").classList.add("hidden-element")
      document.getElementById("quantity-input-wrapper").classList.add("hidden-element")
      document.getElementById("subscription").classList.remove("hidden-element")
      document.getElementById("oncelabel").classList.remove("checked")
      document.getElementById("subslabel").classList.add("checked")
      document.getElementById("subscription-price-wrapper").classList.remove("hidden-element")
      document.getElementById("subscription-checkmark-wrapper").classList.remove("hidden-element")
    }
  }
  const metafields = {{ curr_variant.metafields.global | json }}
  const subscriptionSize = metafields.hasOwnProperty("subscriptions") ? metafields.subscriptions.length : 0
  document.querySelectorAll("#quantity-input > input[type=number]").forEach(element => element.addEventListener("change", (e) => {
    const quantity = e.target.value
    const prices = {{ curr_variant.metafields.global.prices }}
    let unitPrice
    if(quantity == 1) {
      document.getElementById("once-0").checked = true
      document.getElementById("once-0-wrapper").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 0) {
          document.getElementById(`once-${index}-wrapper`).classList.remove("active-variant")
        }
      })
      document.getElementById("total").innerHTML = `${(prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare").innerHTML = ""
      unitPrice = prices[0].reference * prices[0].cost / prices[0].content
      document.getElementById("unitprice").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[0].reference} ${prices[0].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    } else if (quantity == 2) {
      document.getElementById("once-1").checked = true
      document.getElementById("once-1-wrapper").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 1) {
          document.getElementById(`once-${index}-wrapper`).classList.remove("active-variant")
        }
      })
      document.getElementById("total").innerHTML = `${(2 * prices[1].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare").innerHTML = `${(2 * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      unitPrice = prices[1].reference * (2 * prices[1].cost) / prices[1].content
      document.getElementById("unitprice").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[1].reference} ${prices[1].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    } else {
      document.getElementById("once-2").checked = true
      document.getElementById("once-2-wrapper").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 2) {
          document.getElementById(`once-${index}-wrapper`).classList.remove("active-variant")
        }
      })
      document.getElementById("total").innerHTML = `${(Number(quantity) * prices[2].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare").innerHTML = `${(Number(quantity) * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      unitPrice = prices[2].reference * (3 * prices[2].cost) / prices[2].content
      document.getElementById("unitprice").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[2].reference} ${prices[2].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    }
  }))
  document.querySelectorAll("input[name=onetime]").forEach((element, index) => element.addEventListener("change", (e) => {
    const quantity = index + 1
    const prices = {{ curr_variant.metafields.global.prices }}
    prices.forEach((price, pindex ) => {
      if (pindex == index) {
        document.getElementById(`once-${pindex}-wrapper`).classList.add("active-variant")
      } else {
        document.getElementById(`once-${pindex}-wrapper`).classList.remove("active-variant")
      }
    })
    document.querySelector("#quantity-input > input[type=number]").value = `${quantity}`
    document.getElementById("total").innerHTML = `${(Number(quantity) * prices[Number(quantity) - 1].cost / 100).toFixed(2).replace(".",",")} €`
      if(quantity > 1) {
        document.getElementById("totalcompare").innerHTML = `${(Number(quantity) * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      } else {
        document.getElementById("totalcompare").innerHTML = ""
      }
      unitPrice = prices[Number(quantity) - 1].reference * (Number(quantity) * prices[Number(quantity) - 1].cost) / prices[Number(quantity) - 1].content
      document.getElementById("unitprice").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[Number(quantity) - 1].reference} ${prices[Number(quantity) - 1].unit}`
    document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
  }))
  document.querySelectorAll("#quantity-input-nosub > input[type=number]").forEach(element => element.addEventListener("change", (e) => {
    const quantity = e.target.value
    const prices = {{ curr_variant.metafields.global.prices }}
    let unitPrice
    if(quantity == 1) {
      document.getElementById("once-0-nosub").checked = true
      document.getElementById("once-0-wrapper-nosub").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 0) {
          document.getElementById(`once-${index}-wrapper-nosub`).classList.remove("active-variant")
        }
      })
      document.getElementById("total-nosub").innerHTML = `${(prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare-nosub").innerHTML = ""
      unitPrice = prices[0].reference * prices[0].cost / prices[0].content
      document.getElementById("unitprice-nosub").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[0].reference} ${prices[0].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    } else if (quantity == 2) {
      document.getElementById("once-1-nosub").checked = true
      document.getElementById("once-1-wrapper-nosub").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 1) {
          document.getElementById(`once-${index}-wrapper-nosub`).classList.remove("active-variant")
        }
      })
      document.getElementById("total-nosub").innerHTML = `${(2 * prices[1].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare-nosub").innerHTML = `${(2 * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      unitPrice = prices[1].reference * (2 * prices[1].cost) / prices[1].content
      document.getElementById("unitprice-nosub").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[1].reference} ${prices[1].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    } else {
      document.getElementById("once-2-nosub").checked = true
      document.getElementById("once-2-wrapper-nosub").classList.add("active-variant")
      prices.forEach((price, index) => {
        if(index != 2) {
          document.getElementById(`once-${index}-wrapper-nosub`).classList.remove("active-variant")
        }
      })
      document.getElementById("total-nosub").innerHTML = `${(Number(quantity) * prices[2].cost / 100).toFixed(2).replace(".",",")} €`
      document.getElementById("totalcompare-nosub").innerHTML = `${(Number(quantity) * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      unitPrice = prices[2].reference * (3 * prices[2].cost) / prices[2].content
      document.getElementById("unitprice-nosub").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[2].reference} ${prices[2].unit}`
      document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
    }
  }))
  document.querySelectorAll("input[name=onetime-nosub]").forEach((element, index) => element.addEventListener("change", (e) => {
    const quantity = index + 1
    const prices = {{ curr_variant.metafields.global.prices }}
    prices.forEach((price, pindex ) => {
      if (pindex == index) {
        document.getElementById(`once-${pindex}-wrapper-nosub`).classList.add("active-variant")
      } else {
        document.getElementById(`once-${pindex}-wrapper-nosub`).classList.remove("active-variant")
      }
    })
    document.querySelector("#quantity-input-nosub > input[type=number]").value = `${quantity}`
      document.getElementById("total-nosub").innerHTML = `${(Number(quantity) * prices[Number(quantity) - 1].cost / 100).toFixed(2).replace(".",",")} €`
      if(quantity > 1) {
        document.getElementById("totalcompare-nosub").innerHTML = `${(Number(quantity) * prices[0].cost / 100).toFixed(2).replace(".",",")} €`
      } else {
        document.getElementById("totalcompare-nosub").innerHTML = ""
      }
      unitPrice = prices[Number(quantity) - 1].reference * (Number(quantity) * prices[Number(quantity) - 1].cost) / prices[Number(quantity) - 1].content
      document.getElementById("unitprice-nosub").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[Number(quantity) - 1].reference} ${prices[Number(quantity) - 1].unit}`
    document.querySelectorAll(".revy-bundle-add-button").forEach(element => element.dataset.quantity = `${quantity}`)
  }))
  document.querySelectorAll("#subscription input[type=radio]").forEach((element, sindex, subsarray) => {
    if(subsarray.length > 0) {
    element.addEventListener("change", (e) => {
      if(e.target.checked) {
        const subscriptions = {{ curr_variant.metafields.global.subscriptions }}
        const prices = {{ curr_variant.metafields.global.prices }}
        const number = Number(e.target.id.replace("sub-",""))
        subscriptions.forEach((subscription, index) => {
          if(index == number) {
          document.getElementById(`sub-${index}-wrapper`).classList.add("active-variant")
          } else {
          document.getElementById(`sub-${index}-wrapper`).classList.remove("active-variant")
          }
        })
        document.getElementById("substotal").innerHTML = `${(subscriptions[number].cost / 100).toFixed(2).replace(".", ",")} €`
        const compareIndex = prices.findIndex(obj => obj.content === subscriptions[number].content)
        const quantity = compareIndex + 1
        const compareGood = prices[compareIndex] || null
        document.getElementById("substotalcompare").innerHTML = compareGood
          ?  subscriptions[number].cost < (quantity * compareGood.cost)
            ? `${(quantity * compareGood.cost / 100).toFixed(2).replace(".", ",")} €` 
            : ""
          : ""
        const unitPrice = subscriptions[number].reference * subscriptions[number].cost / subscriptions[number].content
        document.getElementById("subsunitprice").innerHTML = `${(unitPrice / 100).toFixed(2).replace(".",",")} €/${prices[2].reference} ${prices[2].unit}`
      }
    })
  }
  })
  function changeLink(e) {
    const subscriptions = {{ curr_variant.metafields.global.subscriptions.value | json }}
    const checkedValue = Number(e.target.value)
    const vid = subscriptions[checkedValue].vid
    const url = `https://abo.schlafdrink.de/cart/${vid}:1`
    document.getElementById("subscription-link").href = url
  }
  document.querySelectorAll("input[name='mode']").forEach(element => element.addEventListener("change",changeButtons))
  document.querySelectorAll("input[name='subscription']").forEach(element => element.addEventListener("change", changeLink))
</script>
